{% extends 'main.html' %}
{% load static %}

{% block title %}User Profile | BTTI EVIS{% endblock %}

{% block content %}
<section class="py-5 bg-light min-vh-100">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-9">

        <!-- Profile Card -->
        <div class="card shadow-lg border-0 rounded-4 overflow-hidden">

          <!-- Header -->
          <div class="bg-success text-white text-center py-4">
            <h3 class="fw-bold mb-0">My Profile</h3>
            <p class="mb-0 small">Manage your account settings and details</p>
          </div>

          <!-- Body -->
          <div class="card-body p-4">

            <!-- Top Section with Profile Picture -->
            <div class="text-center mb-4">
              <div class="position-relative d-inline-block">
                {% if request.user.image %}
                  <img src="{{ request.user.image.url }}" alt="Profile Picture"
                      class="rounded-circle border border-4 border-white shadow"
                      style="width: 130px; height: 130px; object-fit: cover;">
                {% else %}
                  <img src="{% static 'assets/img/prof.png' %}" alt="Default Profile"
                      class="rounded-circle border border-4 border-white shadow"
                      style="width: 130px; height: 130px; object-fit: cover;">
                {% endif %}

                <!-- Edit Icon -->
                <a href="{% url 'pro_pic' %}"
                  class="position-absolute bottom-0 end-0 bg-success text-white rounded-circle p-2 shadow"
                  style="transform: translate(20%, 20%);">
                  <i class="bi bi-pencil-fill"></i>
                </a>
              </div>

              <h4 class="fw-bold text-dark mt-3 mb-0">{{ user.get_full_name|default:user.username }}</h4>
              <p class="text-muted small mb-2">@{{ user.username }}</p>
              {% if user.is_superuser %}
                <span class="badge bg-danger px-3 py-2 rounded-pill">Administrator</span>
              {% elif user.is_staff %}
                <span class="badge bg-primary px-3 py-2 rounded-pill">Staff</span>
              {% else %}
                <span class="badge bg-secondary px-3 py-2 rounded-pill">Student</span>
              {% endif %}
            </div>

          <!-- Tabs -->
<ul class="nav nav-pills flex-column flex-sm-row justify-content-center mb-4 gap-2" id="profileTabs" role="tablist">
  <li class="nav-item flex-fill text-center" role="presentation">
    <button class="nav-link active w-100 fw-semibold rounded-pill shadow-sm py-2" 
            id="info-tab" data-bs-toggle="tab" data-bs-target="#info" 
            type="button" role="tab" aria-controls="info" aria-selected="true">
      <i class="bi bi-person-badge me-2"></i>Profile Info
    </button>
  </li>
  <li class="nav-item flex-fill text-center" role="presentation">
    <button class="nav-link w-100 fw-semibold rounded-pill shadow-sm py-2" 
            id="security-tab" data-bs-toggle="tab" data-bs-target="#security" 
            type="button" role="tab" aria-controls="security" aria-selected="false">
      <i class="bi bi-shield-lock me-2"></i>Security
    </button>
  </li>
  <li class="nav-item flex-fill text-center" role="presentation">
    <button class="nav-link w-100 fw-semibold rounded-pill shadow-sm py-2" 
            id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" 
            type="button" role="tab" aria-controls="activity" aria-selected="false">
      <i class="bi bi-clock-history me-2"></i>Activity
    </button>
  </li>
</ul>

<!-- Extra CSS for styling -->
<style>
  #profileTabs .nav-link {
    background: #f8f9fa;
    color: #333;
    border: 1px solid #dee2e6;
    transition: all 0.3s ease;
  }
  #profileTabs .nav-link:hover {
    background: #e9ecef;
  }
  #profileTabs .nav-link.active {
    background: #198754; /* Bootstrap success green */
    color: #fff;
    border-color: #198754;
  }
  @media (max-width: 576px) {
    #profileTabs .nav-link {
      font-size: 14px;
      padding: 0.6rem;
    }
  }
</style>
<!--Tabs-->
            <div class="tab-content" id="profileTabsContent">

              <!-- Profile Info -->
              <div class="tab-pane fade show active" id="info" role="tabpanel" aria-labelledby="info-tab">
                <div class="row g-3 text-start">
                  <div class="col-md-6">
                    <p><i class="bi bi-envelope-at text-success me-2"></i><strong>Email:</strong> {{ user.email }}</p>
                  </div>
                  <div class="col-md-6">
                    <p><i class="bi bi-credit-card text-success me-2"></i><strong>Admission No:</strong> {{ user.admission_number }}</p>
                  </div>
                  <div class="col-md-6">
                    <p><i class="bi bi-calendar-event text-success me-2"></i><strong>Joined:</strong> {{ user.date_joined|date:"F j, Y" }}</p>
                  </div>
                  <div class="col-md-6">
                    <p><i class="bi bi-clock-history text-success me-2"></i><strong>Last Login:</strong> {{ user.last_login|date:"F j, Y, g:i A" }}</p>
                  </div>
                </div>
              </div>

              <!-- Security -->
              <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
                <div class="text-center">
                  <p class="text-muted mb-4">Manage your account security options here.</p>
                  <a href="{% url 'reset_password' %}" class="btn btn-outline-primary fw-semibold rounded-pill shadow-sm px-4">
                    <i class="bi bi-lock me-2"></i>Change Password
                  </a>
                </div>
              </div>

              <!-- Activity -->
              <div class="tab-pane fade" id="activity" role="tabpanel" aria-labelledby="activity-tab">
                <p class="text-muted text-center">Recent activity logs can appear here (e.g., login times, voting actions).</p>
                <!-- Placeholder list -->
                <ul class="list-group list-group-flush">
                  {% for activity in activities %}
                  <li class="list-group-item"><i class="bi bi-box-arrow-in-right text-success me-2"></i>{{ activity.action }}</li>
                {% endfor %}
              </ul>
              </div>
            </div>

            <hr class="my-4">

            <!-- Logout -->
            <div class="text-center">
              <a href="{% url 'logout' %}" class="btn btn-outline-danger fw-semibold rounded-pill shadow-sm px-4">
                <i class="bi bi-box-arrow-right me-2"></i>Logout
              </a>
            </div>

          </div>
        </div>
        <!-- End Profile Card -->

      </div>
    </div>
  </div>
</section>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
{% endblock %}
