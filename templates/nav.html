{% load static %}
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm sticky-top">
  <div class="container-fluid container-xl">

    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}">
      <img src="{% static 'assets/img/logo1.png' %}" alt="BTTI Logo" class="me-2" style="height: 45px;">
      <span class="fw-bold text-uppercase fs-5">BTTI EVIS</span>
    </a>

    <!-- Hamburger Toggle -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Nav Links -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">

        <!-- Home -->
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="{% url 'home' %}">
            <i class="bi bi-house-door me-1"></i> Home
          </a>
        </li>

        <!-- Elections Dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle {% if request.resolver_match.url_name in 'elections verify_voting_id vote_result' %}active{% endif %}" 
             href="#" id="electionsDropdown" role="button" data-bs-toggle="dropdown">
            <i class="bi bi-ballot me-1"></i> Elections
          </a>
          <ul class="dropdown-menu shadow border-0 rounded-3 mt-2">
            {% if request.user.has_voted %}
              <li><a class="dropdown-item" href="{% url 'elections' %}"><i class="bi bi-check2-circle me-2"></i>Active Elections</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-bar-chart-line me-2"></i>Results</a></li>
            {% else %}
              <li><a class="dropdown-item" href="{% url 'verify_voting_id' %}"><i class="bi bi-shield-lock me-2"></i>Verify Voting ID</a></li>
            {% endif %}
            <li><a class="dropdown-item" href="{% url 'elections_done' %}"><i class="bi bi-archive me-2"></i>Past Elections</a></li>
          </ul>
        </li>

        <!-- About -->
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'about' %}active{% endif %}" href="{% url 'about' %}">
            <i class="bi bi-info-circle me-1"></i> About
          </a>
        </li>

        <!-- Contact -->
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'contact' %}active{% endif %}" href="{% url 'contact' %}">
            <i class="bi bi-envelope me-1"></i> Contact
          </a>
        </li>

        <!-- Profile Dropdown -->
<li class="nav-item dropdown ms-lg-3">
  <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown">
    {% if request.user.is_authenticated and request.user.image %}
      <img src="{{ user.image.url }}" alt="Avatar" 
           class="rounded-circle me-2 border border-2 border-light shadow-sm"
           style="width: 32px; height: 32px; object-fit: cover;">
    {% else %}
      <i class="bi bi-person-circle fs-5 me-1"></i>
    {% endif %}
    <span class="d-none d-lg-inline fw-semibold">
      {% if user.is_authenticated %}
        {{ user.username|capfirst }}
      {% else %}
        Account
      {% endif %}
    </span>
  </a>

  <ul class="dropdown-menu dropdown-menu-end shadow border-0 rounded-3 mt-2 p-2" aria-labelledby="profileDropdown">
    <!-- Header -->
    <li class="dropdown-header text-center">
      {% if user.is_authenticated %}
        <strong class="d-block">{{ user.get_full_name|default:user.username }}</strong>
        <small class="text-muted">{{ user.email }}</small>
      {% else %}
        <strong>Welcome!</strong><br>
        <small class="text-muted">Please login</small>
      {% endif %}
    </li>
    <li><hr class="dropdown-divider"></li>

    {% if user.is_authenticated %}
      <!-- Authenticated User Links -->
      <li><a class="dropdown-item" href="{% url 'my-profile' %}"><i class="bi bi-person-lines-fill me-2"></i>Profile Settings</a></li>
      <li><a class="dropdown-item" href="{% url 'home' %}"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
      <li><a class="dropdown-item" href="{% url 'reset_password' %}"><i class="bi bi-lock me-2"></i>Change Password</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item text-danger" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
    {% else %}
      <!-- Guest User Links -->
      <li><a class="dropdown-item" href="{% url 'login-user' %}"><i class="bi bi-box-arrow-in-right me-2"></i>Login</a></li>
      <li><a class="dropdown-item" href="{% url 'admin_dashboard' %}"><i class="bi bi-gear me-2"></i>Admin Login</a></li>
      <li><a class="dropdown-item" href="{% url 'signup' %}"><i class="bi bi-person-plus me-2"></i>Register</a></li>
    {% endif %}
  </ul>
</li>
<!-- End Profile Dropdown -->


      </ul>
    </div>

  </div>
</nav>

<!-- Custom Styling -->
<style>
  .navbar .nav-link {
    position: relative;
    transition: color 0.3s ease;
  }
  .navbar .nav-link::after {
    content: "";
    position: absolute;
    width: 0%;
    height: 2px;
    bottom: 0;
    left: 0;
    background-color: #fff;
    transition: width 0.3s ease;
  }
  .navbar .nav-link:hover::after,
  .navbar .nav-link.active::after {
    width: 100%;
  }
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
